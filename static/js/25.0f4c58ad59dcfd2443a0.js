webpackJsonp([25],{UExI:function(e,t){},uumo:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("Dd8w"),s=i.n(a),n={name:"api",data:function(){return{tableData:[],apiData:[],total:0,currentPage:1,pagesize:10,visible:!1,multipleSelection:[],currentRow:null,addvisible:!1,ruleForm:{appKey:"",receiveUrl:"",useSSL:!0,description:""},rules:{appKey:[{required:!0,message:this.$t("message.register-18")+this.$t("message.api-1"),trigger:"change"}],description:[{required:!0,message:this.$t("message.register-18")+this.$t("message.api-5"),trigger:"change"}]},modalType:""}},methods:{handleSelectionChange:function(e){this.multipleSelection=e},btncustomize:function(e,t){var i=this;this.visible=!0,this.currentRow=t,t.apis&&setTimeout(function(){t.apis.map(function(e){return i.$refs.multipleTable.toggleRowSelection(i.apiData.find(function(t){return t.id===e}),!0)})},0)},btncommon:function(e,t){var i=this;this.visible=!0,this.currentRow=t;var a=[];a.push(this.apiData.find(function(e){return"/api/v1/device/findByConditions"===e.api})),a.push(this.apiData.find(function(e){return"/api/v1/alarm/findAlarms"===e.api})),a.push(this.apiData.find(function(e){return"/api/v1/device/swControl"===e.api})),a.push(this.apiData.find(function(e){return"/api/v1/data/findEnergyByDateTime"===e.api})),a.push(this.apiData.find(function(e){return"/api/v1/data/findVariableByDateTime"===e.api})),a.push(this.apiData.find(function(e){return"/api/v1/device/summonVariable"===e.api})),setTimeout(function(){a.map(function(e){return i.$refs.multipleTable.toggleRowSelection(e)},!0)},0)},btnconfirmin:function(){var e=this,t=[];this.multipleSelection.map(function(e){return t.push(e.id)}),this.ajax(e.HOST+"/v1/app/grantApi",{apis:t,id:e.currentRow.id},function(t){0==t.data.errCode?(e.$message({type:"success",message:e.$t("message.register-15")}),e.handleDialogClose(),e.getList(),e.getApiList()):e.$message({type:"fail",message:t.data.msg})})},handleDialogClose:function(){this.visible=!1,this.$refs.multipleTable.clearSelection(),this.currentRow=null},addapi:function(){this.addvisible=!0,this.modalType="create",this.ruleForm={appKey:"",receiveUrl:"",useSSL:!0,description:""}},btnedit:function(e,t){this.addvisible=!0,this.modalType="update",this.ruleForm=s()({},t)},btnsubmit:function(){var e=this;"create"===this.modalType?this.$refs.ruleForm.validate(function(t){if(!t)return!1;e.ajax(e.HOST+"/v1/app/save",{appKey:e.ruleForm.appKey,receiveUrl:e.ruleForm.receiveUrl,useSSL:e.ruleForm.useSSL,description:e.ruleForm.description},function(t){0==t.data.errCode?(e.$message({message:e.$t("message.register-17"),type:"success"}),e.addvisible=!1,e.getList(),e.getApiList()):(e.$message({message:t.data.msg,type:"warning"}),e.addvisible=!1)},function(e){})}):this.$refs.ruleForm.validate(function(t){if(!t)return!1;e.ajax(e.HOST+"/v1/app/update",{id:e.ruleForm.id,appKey:e.ruleForm.appKey,receiveUrl:e.ruleForm.receiveUrl,useSSL:e.ruleForm.useSSL,description:e.ruleForm.description},function(t){0==t.data.errCode?(e.$message({message:e.$t("message.devicemanage-6"),type:"success"}),e.addvisible=!1,e.getList(),e.getApiList()):(e.$message({message:t.data.msg,type:"warning"}),e.addvisible=!1)},function(e){})})},btnpassaudit:function(e,t){var i=this,a=this;this.$confirm(a.$t("message.devicecontrol-16"),a.$t("message.devicetype-7"),{confirmButtonText:a.$t("message.devicetype-8"),cancelButtonText:a.$t("message.devicetype-9"),type:"warning"}).then(function(){i.ajax(a.HOST+"/v1/app/customer/audit",{id:t.id,auditFlag:!0},function(e){0==e.data.errCode&&(a.$message({type:"success",message:a.$t("message.register-15")}),a.getList())})}).catch(function(){})},getList:function(){var e=this;e.ajax(e.HOST+"/v1/app/findByConditions",{currentPage:e.currentPage,rows:e.pagesize},function(t){0==t.data.errCode&&(e.tableData=t.data.data,e.total=t.data.totalCount)},function(e){})},getApiList:function(){var e=this;e.ajax(e.HOST+"/v1/app/api/findByConditions",{currentPage:1,rows:999},function(t){0==t.data.errCode&&(e.apiData=t.data.data)},function(e){})}},mounted:function(){this.getList(),this.getApiList()}},r={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"shebei"},[i("el-row",[i("el-col",{staticStyle:{"padding-top":"15px","padding-bottom":"15px",background:"#E4E7ED"}},[i("div",{staticStyle:{"margin-left":"10px"}},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addapi}},[e._v(e._s(e.$t("message.api-11")))])],1)])],1),e._v(" "),i("el-row",[i("el-col",[i("div",{staticStyle:{margin:"10px 10px 0 10px"}},[i("el-table",{staticClass:"table",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:""}},[i("el-table-column",{attrs:{prop:"appKey",label:e.$t("message.api-1"),width:"100",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"appSecret",label:e.$t("message.api-2"),width:"300",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"receiveUrl",label:e.$t("message.api-3"),width:"350",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{label:e.$t("message.api-4"),width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.useSSL?i("span",[e._v("\n                "+e._s(e.$t("message.register-19"))+"\n              ")]):i("span",[e._v(e._s(e.$t("message.register-20")))])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"description",label:e.$t("message.api-5"),width:"250",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{label:e.$t("message.device-20"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.apis?e._e():i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){e.btncommon(t.index,t.row)}}},[e._v(e._s(e.$t("message.api-6")))]),e._v(" "),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){e.btncustomize(t.index,t.row)}}},[e._v(e._s(e.$t("message.api-7")))]),e._v(" "),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){e.btnedit(t.index,t.row)}}},[e._v(e._s(e.$t("message.devicetype-2")))])]}}])})],1)],1)])],1),e._v(" "),i("el-dialog",{attrs:{width:"80%",title:e.$t("message.menus-21"),visible:e.visible,"append-to-body":""},on:{"update:visible":function(t){e.visible=t},close:e.handleDialogClose}},[i("el-table",{ref:"multipleTable",staticClass:"table",staticStyle:{width:"100%"},attrs:{data:e.apiData,stripe:"",height:"550"},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{prop:"api",label:e.$t("message.api-8"),width:"300",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"description",label:e.$t("message.api-9"),align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"category",label:e.$t("message.api-10"),width:"200",align:"center"}})],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary",plain:""},on:{click:e.handleDialogClose}},[e._v(e._s(e.$t("message.devicetype-4")))]),e._v(" "),i("el-button",{attrs:{type:"success",plain:""},on:{click:e.btnconfirmin}},[e._v(e._s(e.$t("message.devicetype-8")))])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:e.$t("message.api-12"),visible:e.addvisible,width:"30%"},on:{"update:visible":function(t){e.addvisible=t},close:function(t){e.addvisible=!1}}},[i("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"180px"}},[i("el-form-item",{attrs:{label:e.$t("message.api-1"),prop:"appKey"}},[i("el-input",{model:{value:e.ruleForm.appKey,callback:function(t){e.$set(e.ruleForm,"appKey",t)},expression:"ruleForm.appKey"}})],1),e._v(" "),i("el-form-item",{attrs:{label:e.$t("message.api-3"),prop:"receiveUrl"}},[i("el-input",{model:{value:e.ruleForm.receiveUrl,callback:function(t){e.$set(e.ruleForm,"receiveUrl",t)},expression:"ruleForm.receiveUrl"}})],1),e._v(" "),i("el-form-item",{attrs:{label:e.$t("message.api-4"),prop:"useSSL"}},[i("el-switch",{model:{value:e.ruleForm.useSSL,callback:function(t){e.$set(e.ruleForm,"useSSL",t)},expression:"ruleForm.useSSL"}})],1),e._v(" "),i("el-form-item",{attrs:{label:e.$t("message.api-5"),prop:"description"}},[i("el-input",{model:{value:e.ruleForm.description,callback:function(t){e.$set(e.ruleForm,"description",t)},expression:"ruleForm.description"}})],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addvisible=!1}}},[e._v(e._s(e.$t("message.devicetype-4")))]),e._v(" "),i("el-button",{attrs:{type:"success"},on:{click:e.btnsubmit}},[e._v(e._s(e.$t("message.devicetype-8")))])],1)],1)],1)},staticRenderFns:[]};var l=i("VU/8")(n,r,!1,function(e){i("UExI")},"data-v-1dfc0f2c",null);t.default=l.exports}});